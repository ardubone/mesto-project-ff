(()=>{"use strict";var t=function(t){t.classList.toggle("popup_is-opened"),document.addEventListener("keydown",n)},e=function(t){t.classList.toggle("popup_is-opened"),document.removeEventListener("keydown",n)},n=function(t){"Escape"===t.key&&e(document.querySelector(".popup_is-opened"))},o="https://nomoreparties.co/v1/wff-cohort-5",r="123d08a2-0a99-4696-a359-e7de203515b4",c="".concat(o,"/cards"),u="".concat(o,"/cards/likes/"),a="".concat(o,"/users/me/avatar/"),i="".concat(o,"/users/me"),l=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},p=document.querySelector("#card-template").content,s=function(t,e,n){var o=p.querySelector(".card").cloneNode(!0),c=o.querySelector(".card__image"),a=o.querySelector(".card__title"),i=o.querySelector(".card__delete-button"),s=o.querySelector(".card__like-button"),y=o.querySelector(".card__like-counter");return c.src=t.link,a.textContent=t.name,c.alt=t.name,y.textContent=Object.keys(t.likes).length,c.dataset.id=t._id,i.addEventListener("click",(function(){d(t)})),s.addEventListener("click",(function(){var e;s.classList.contains("card__like-button_is-active")?(f(t),function(t){return fetch("".concat(u,"/").concat(t),{method:"DELETE",headers:{authorization:r}}).then(l)}(t._id).then((function(t){y.textContent=t.likes.length}))):(f(t),(e=t._id,fetch("".concat(u,"/").concat(e),{method:"PUT",headers:{authorization:r}}).then(l)).then((function(t){y.textContent=t.likes.length})))})),m(e,t,i),function(t,e,n){(function(t,e){return t.likes.some((function(t){return t._id===e._id}))})(t,e)&&n.classList.add("card__like-button_is-active")}(t,e,s),c.addEventListener("click",(function(){n(t)})),t.element=o,o},d=function(t){t.element.remove()},f=function(t){t.element.querySelector(".card__like-button").classList.toggle("card__like-button_is-active")},m=function(t,e,n){t._id!==e.owner._id&&n.remove()},y=/^[a-zA-Zа-яА-Я\s-]*$/;function _(t){return".".concat(t,"-error")}var v=function(t,e,n,o){var r=_(e.id),c=t.querySelector(r);e.classList.add(o.inputErrorClass),c.textContent=n},h=function(t,e,n){var o=_(e.id),r=t.querySelector(o);e.classList.remove(n.inputErrorClass),r.textContent=""};function b(t,e,n){return e.validity.valid?"url"===e.type||y.test(e.value)?(h(t,e,n),!0):(v(t,e,"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы",n),!1):(v(t,e,e.validationMessage,n),!1)}var S=function(t,e){var n=Array.from(t.querySelectorAll(e.popupInput)),o=t.querySelector(e.popupButton);n.forEach((function(r){r.addEventListener("input",(function(){b(t,r,e),function(t,e,n){!function(t,e){return!t.every((function(t){return b(t.parentElement,t,e)}))}(t,n)?e.classList.remove(n.popupButtonDisabled):e.classList.add(n.popupButtonDisabled)}(n,o,e)}))}))};function k(t,e){t.querySelectorAll(e.popupInput).forEach((function(n){h(t,n,e)})),function(t,e){t.querySelector(e.popupButton).classList.remove(e.popupButtonDisabled)}(t,e)}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var q,g=document.querySelector(".profile__image"),L=document.querySelector(".profile__edit-button"),C=document.querySelector(".popup_type_edit"),x=document.querySelector(".places__list"),A=document.querySelector(".profile__add-button"),j=document.querySelector(".popup_type_new-card"),w=document.querySelectorAll(".popup__close"),D=document.querySelector(".popup_type_avatar"),O=document.forms.edit_avatar,T=O.elements.avatar,z=document.forms.edit_profile,I=z.elements.name,B=z.elements.description,P=document.querySelectorAll(".popup"),N=document.querySelector('button[type="submit"]'),J=document.querySelector(".profile__title"),F=document.querySelector(".profile__description"),H=document.forms.new_place,M=H.elements.place_name,U=H.elements.link,$=document.querySelector(".popup_type_image"),Z=$.querySelector(".popup__image"),G=$.querySelector(".popup__caption"),K={inputErrorClass:"popup__input_type_error",popupButtonDisabled:"popup__button_disabled",popupInput:".popup__input",popupButton:".popup__button",popupForm:".popup",popupErrortext:".popup__error-text"};function Q(t){console.error("Ошибка:",t)}function R(t){N.textContent=t?"Сохранение...":"Сохранить"}function V(e){Z.src=e.link,Z.alt=e.name,G.textContent=e.name,t($)}function W(t){F.textContent=t.about,J.textContent=t.name,g.style.backgroundImage="url('".concat(t.avatar,"')")}P.forEach((function(t){t.classList.contains("popup_is-animated")||t.classList.add("popup_is-animated")})),g.addEventListener("click",(function(){t(D),k(D,K)})),L.addEventListener("click",(function(){t(C),I.value=J.textContent,B.value=F.textContent,k(C,K)})),A.addEventListener("click",(function(){t(j),k(j,K)})),w.forEach((function(t){var n=t.closest(".popup");t.addEventListener("click",(function(){return e(n)}))})),P.forEach((function(t){t.addEventListener("click",(function(n){n.target===t&&e(t)}))})),O.addEventListener("submit",(function(t){t.preventDefault(),R(!0),function(t){return fetch(a,{method:"PATCH",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(l)}(T=O.elements.avatar.value).then((function(){g.style.backgroundImage="url('".concat(T,"')"),e(D)})).catch((function(t){Q(t)})).finally((function(){R(!1)}))})),z.addEventListener("submit",(function(t){var n,o;t.preventDefault(),R(!0),(n=I.value,o=B.value,fetch(i,{method:"PATCH",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({name:n,about:o})}).then(l)).then((function(t){W(t),J.textContent=I.value,F.textContent=B.value,e(C)})).catch((function(t){Q(t)})).finally((function(){R(!1)}))})),H.addEventListener("submit",(function(t){t.preventDefault(),R(!0);var n,o,u={name:M.value,link:U.value};(n=u.name,o=u.link,fetch(c,{method:"POST",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({name:n,link:o})}).then(l)).then((function(t){x.prepend(s(t,V)),H.reset(),e(j)})).catch((function(t){Q(t)})).finally((function(){R(!1)}))})),q=K,Array.from(document.querySelectorAll(q.popupForm)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),S(t,q)})),Promise.all([fetch(i,{headers:{authorization:r}}).then(l),fetch(c,{headers:{authorization:r}}).then(l)]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(a.push(o.value),a.length!==e);i=!0);}catch(t){l=!0,r=t}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw r}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0];!function(t,e){e.forEach((function(e){var n=s(e,t,V);x.append(n)}))}(r,o[1]),W(r)})).catch((function(t){Q(t)}))})();